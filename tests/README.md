# üß™ Guia Completo de Testes - Fintelli

Este documento fornece instru√ß√µes detalhadas para executar todos os tipos de testes dispon√≠veis no projeto Fintelli.

## üìã √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Testes de Frontend](#testes-de-frontend)
- [Testes de Backend](#testes-de-backend)
- [Testes de Integra√ß√£o](#testes-de-integra√ß√£o)
- [Valida√ß√µes de Componentes](#valida√ß√µes-de-componentes)
- [Scripts Automatizados](#scripts-automatizados)
- [Troubleshooting](#troubleshooting)

## üîç Vis√£o Geral

O Fintelli possui uma su√≠te completa de testes que cobre:

- ‚úÖ **Frontend**: Jest, React Testing Library, Cypress
- ‚úÖ **Backend**: Pytest, FastAPI TestClient
- ‚úÖ **APIs**: Testes de endpoint, valida√ß√£o de dados
- ‚úÖ **Banco de Dados**: PostgreSQL, integridade de dados
- ‚úÖ **Cache**: Redis, performance e persist√™ncia
- ‚úÖ **Observabilidade**: Prometheus, Jaeger, OpenTelemetry
- ‚úÖ **Docker**: Containers, networking, volumes
- ‚úÖ **Integra√ß√£o**: Testes end-to-end
- ‚úÖ **JavaScript**: Utilit√°rios, valida√ß√µes, performance

## üõ†Ô∏è Pr√©-requisitos

### Software Necess√°rio

```bash
# Node.js e npm (para testes frontend)
node --version   # >= 16.0.0
npm --version    # >= 8.0.0

# Python e pip (para testes backend)
python --version # >= 3.9
pip --version    # >= 21.0

# Docker e Docker Compose
docker --version          # >= 20.0.0
docker-compose --version  # >= 1.29.0

# Ferramentas adicionais
curl --version   # Para testes de API
jq --version     # Para parsing JSON
```

### Ambiente de Desenvolvimento

```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/seu-usuario/fintelli.git
cd fintelli

# 2. Configure o ambiente
cp .env_sample .env
# Edite .env com suas configura√ß√µes

# 3. Suba a aplica√ß√£o
docker-compose up -d

# 4. Aguarde todos os servi√ßos ficarem prontos (2-3 minutos)
docker-compose ps
```

## üé® Testes de Frontend

### Configura√ß√£o

```bash
cd tests/frontend
npm install
```

### Executando Testes

```bash
# Todos os testes
npm test

# Testes em modo watch (desenvolvimento)
npm run test:watch

# Relat√≥rio de cobertura
npm run test:coverage

# Testes unit√°rios apenas
npm run test:unit

# Testes de integra√ß√£o apenas
npm run test:integration

# Testes E2E com Cypress
npm run test:e2e:open  # Interface gr√°fica
npm run test:e2e       # Headless
```

### Estrutura dos Testes Frontend

```
tests/frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/           # Testes de componentes React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TransactionForm.test.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TransactionList.test.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SummaryCard.test.tsx
‚îÇ   ‚îú‚îÄ‚îÄ utils/               # Testes de utilit√°rios JS
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ javascript.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ setupTests.ts        # Configura√ß√£o global
‚îú‚îÄ‚îÄ integration/             # Testes de integra√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ api.test.ts         # Testes de API
‚îú‚îÄ‚îÄ cypress/                # Testes E2E (se configurado)
‚îÇ   ‚îú‚îÄ‚îÄ fixtures/
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îî‚îÄ‚îÄ support/
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ jest.config.js
```

### Comandos √öteis

```bash
# Executar teste espec√≠fico
npm test TransactionForm.test.tsx

# Debug de testes
npm test -- --verbose

# Atualizar snapshots
npm test -- --updateSnapshot

# Executar com coverage espec√≠fico
npm test -- --collectCoverageFrom="src/components/**/*.{ts,tsx}"
```

## ‚öôÔ∏è Testes de Backend

### Configura√ß√£o

```bash
cd tests/backend
pip install -r requirements.txt
```

### Executando Testes

```bash
# Todos os testes
pytest

# Teste espec√≠fico
pytest test_api.py

# Com cobertura
pytest --cov=app --cov-report=html

# Paralelo (mais r√°pido)
pytest -n auto

# Verboso
pytest -v

# Parar no primeiro erro
pytest -x

# Testes por categoria
pytest -m "unit"        # Testes unit√°rios
pytest -m "integration" # Testes de integra√ß√£o
```

### Estrutura dos Testes Backend

```
tests/backend/
‚îú‚îÄ‚îÄ test_api.py           # Testes de endpoints FastAPI
‚îú‚îÄ‚îÄ test_database.py      # Testes PostgreSQL
‚îú‚îÄ‚îÄ test_redis.py         # Testes Redis
‚îú‚îÄ‚îÄ test_prometheus.py    # Testes de m√©tricas
‚îú‚îÄ‚îÄ test_jaeger.py        # Testes de traces
‚îú‚îÄ‚îÄ test_opentelemetry.py # Testes de telemetria
‚îú‚îÄ‚îÄ test_docker.py        # Testes de containeriza√ß√£o
‚îú‚îÄ‚îÄ conftest.py          # Fixtures compartilhadas
‚îî‚îÄ‚îÄ requirements.txt     # Depend√™ncias de teste
```

### Executando Testes Espec√≠ficos

```bash
# Testes de API
pytest test_api.py::TestTransactionsAPI::test_create_transaction

# Testes de banco
pytest test_database.py -v

# Testes de cache
pytest test_redis.py::TestRedisValidation

# Testes de observabilidade
pytest test_prometheus.py test_jaeger.py
```

## üîó Testes de Integra√ß√£o

### Script Principal

O script `tests/integration/run_tests.sh` executa uma valida√ß√£o completa de toda a stack:

```bash
# Executar todos os testes de integra√ß√£o
./tests/integration/run_tests.sh

# Executar com logs detalhados
./tests/integration/run_tests.sh --verbose

# Executar testes espec√≠ficos
./tests/integration/run_tests.sh --only="frontend,backend,database"
```

### O que o Script Testa

1. **Containers Docker**
   - Status de todos os containers
   - Health checks
   - Conectividade entre servi√ßos

2. **APIs e Endpoints**
   - Health checks de APIs
   - Valida√ß√£o de dados retornados
   - Performance b√°sica

3. **Banco de Dados**
   - Conectividade PostgreSQL
   - Integridade de tabelas
   - Opera√ß√µes CRUD

4. **Cache Redis**
   - Conectividade
   - Opera√ß√µes b√°sicas
   - Performance

5. **Observabilidade**
   - OpenTelemetry Collector
   - Prometheus m√©tricas
   - Jaeger traces

6. **Frontend**
   - Carregamento da p√°gina
   - Assets JavaScript
   - Integra√ß√£o com backend

### Exemplo de Sa√≠da

```
üöÄ Iniciando Testes de Integra√ß√£o do Fintelli
==============================================

[INFO] Verificando containers Docker...
[SUCCESS] Container fintelli_frontend est√° rodando
[SUCCESS] Container fintelli_backend est√° rodando
[SUCCESS] Container fintelli_db est√° rodando
[SUCCESS] Container fintelli_cache est√° rodando

[INFO] Testando Frontend em http://localhost:8080
[SUCCESS] Frontend est√° funcionando

[INFO] Testando endpoints da API...
[SUCCESS] Endpoint /api/summary retornou dados v√°lidos
[SUCCESS] Endpoint /api/transactions retornou dados v√°lidos

==============================================
[SUCCESS] Todos os testes de integra√ß√£o passaram! üéâ
==============================================
```

## üîç Valida√ß√µes de Componentes

### PostgreSQL

```bash
# Conectar ao banco
docker exec -it fintelli_db psql -U finance_user -d finance_db

# Verificar dados
SELECT COUNT(*) FROM transactions;
SELECT * FROM transactions ORDER BY created_at DESC LIMIT 5;

# Verificar performance
EXPLAIN ANALYZE SELECT * FROM transactions WHERE date >= '2024-01-01';
```

### Redis

```bash
# Conectar ao Redis
docker exec -it fintelli_cache redis-cli

# Verificar chaves
KEYS fintelli:*

# Verificar cache de summary
GET fintelli:summary

# Verificar estat√≠sticas
INFO stats
```

### Prometheus

```bash
# Acessar m√©tricas via API
curl http://localhost:9091/api/v1/query?query=up

# Verificar targets
curl http://localhost:9091/api/v1/targets

# M√©tricas customizadas
curl http://localhost:9091/api/v1/query?query=transactions_created_total
```

### Jaeger

```bash
# Listar servi√ßos
curl http://localhost:16687/api/services

# Buscar traces
curl "http://localhost:16687/api/traces?service=fintelli-backend&limit=10"
```

### APIs

```bash
# Health check
curl http://localhost:8001/health

# Resumo financeiro
curl http://localhost:8001/api/summary

# Criar transa√ß√£o
curl -X POST http://localhost:8001/api/transactions \
  -H "Content-Type: application/json" \
  -d '{"type":"income","description":"Teste","amount":100,"date":"2024-01-15"}'
```

## ü§ñ Scripts Automatizados

### Script Master de Testes

Criamos um script que executa TODOS os testes:

```bash
#!/bin/bash
# run_all_tests.sh

echo "üß™ Executando TODOS os testes do Fintelli"
echo "========================================="

# 1. Testes de Backend
echo "‚öôÔ∏è Executando testes de backend..."
cd tests/backend
pytest -v --cov=app
cd ../..

# 2. Testes de Frontend
echo "üé® Executando testes de frontend..."
cd tests/frontend
npm test -- --coverage --watchAll=false
cd ../..

# 3. Testes de Integra√ß√£o
echo "üîó Executando testes de integra√ß√£o..."
./tests/integration/run_tests.sh

echo "‚úÖ Todos os testes conclu√≠dos!"
```

### Scripts de Valida√ß√£o Espec√≠ficos

```bash
# Valida√ß√£o r√°pida (apenas health checks)
./scripts/quick_health_check.sh

# Valida√ß√£o de performance
./scripts/performance_test.sh

# Valida√ß√£o de seguran√ßa
./scripts/security_scan.sh

# Valida√ß√£o de compliance
./scripts/compliance_check.sh
```

## üéØ Comandos de Teste por Categoria

### Testes Unit√°rios

```bash
# Frontend
npm test -- --testNamePattern="unit"

# Backend
pytest -m unit
```

### Testes de Integra√ß√£o

```bash
# Frontend + Backend
npm run test:integration

# Docker + Services
./tests/integration/run_tests.sh
```

### Testes E2E

```bash
# Cypress (se configurado)
npm run test:e2e

# Manual via curl
./scripts/e2e_manual_test.sh
```

### Testes de Performance

```bash
# Backend
pytest test_performance.py

# Redis
redis-benchmark -h localhost -p 6379

# Database
pgbench -h localhost -p 5432 -U finance_user finance_db
```

## üìä Relat√≥rios de Teste

### Coverage Reports

```bash
# Frontend Coverage
cd tests/frontend
npm run test:coverage
open coverage/lcov-report/index.html

# Backend Coverage
cd tests/backend
pytest --cov=app --cov-report=html
open htmlcov/index.html
```

### Test Reports

```bash
# JUnit XML (CI/CD)
pytest --junitxml=test-results.xml

# JSON Report
pytest --json-report --json-report-file=test-report.json
```

## üîß Troubleshooting

### Problemas Comuns

#### 1. Testes de Frontend Falham

```bash
# Limpar cache do Jest
npm test -- --clearCache

# Reinstalar depend√™ncias
rm -rf node_modules package-lock.json
npm install

# Verificar vers√µes
node --version
npm --version
```

#### 2. Testes de Backend Falham

```bash
# Verificar depend√™ncias Python
pip install -r requirements.txt --upgrade

# Verificar vari√°veis de ambiente
echo $DATABASE_URL
echo $REDIS_URL

# Verificar conex√£o com servi√ßos
curl http://localhost:8001/health
```

#### 3. Servi√ßos N√£o Respondem

```bash
# Verificar containers
docker-compose ps

# Restart dos servi√ßos
docker-compose restart

# Logs detalhados
docker-compose logs -f
```

#### 4. Problemas de Performance

```bash
# Verificar recursos
docker stats

# Verificar disk space
df -h

# Verificar memory
free -h
```

### Logs de Debug

```bash
# Backend detalhado
docker-compose logs backend | grep ERROR

# Frontend detalhado
docker-compose logs frontend | grep nginx

# Database detalhado
docker-compose logs db | tail -50
```

## üìù Boas Pr√°ticas

### 1. **Sempre Execute Testes Antes de Commit**

```bash
# Git hook recomendado (pre-commit)
#!/bin/bash
npm test --watchAll=false
pytest
./tests/integration/run_tests.sh --quick
```

### 2. **Mantenha Dados de Teste Limpos**

```bash
# Limpar dados entre testes
docker-compose down -v
docker-compose up -d
```

### 3. **Use Mocks Apropriados**

```javascript
// Frontend
jest.mock('../services/api');

// Backend
@pytest.fixture
def mock_database():
    return MagicMock()
```

### 4. **Monitore Coverage**

```bash
# Manter coverage > 80%
pytest --cov=app --cov-fail-under=80
```

### 5. **Automatize no CI/CD**

```yaml
# .github/workflows/tests.yml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run Integration Tests
        run: ./tests/integration/run_tests.sh
```

## üöÄ Pr√≥ximos Passos

### Expans√£o dos Testes

1. **Testes de Carga**: k6, Artillery
2. **Testes de Seguran√ßa**: OWASP ZAP, Bandit
3. **Testes de Acessibilidade**: axe-core
4. **Testes Visuais**: Percy, Chromatic

### Automa√ß√£o

1. **CI/CD Pipeline**: GitHub Actions, GitLab CI
2. **Quality Gates**: SonarQube
3. **Deployment Testing**: Smoke tests
4. **Monitoring**: Alertas baseados em m√©tricas

---

## üìö Recursos Adicionais

- [Jest Documentation](https://jestjs.io/docs/getting-started)
- [Pytest Documentation](https://docs.pytest.org/)
- [FastAPI Testing](https://fastapi.tiangolo.com/tutorial/testing/)
- [React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)
- [Docker Testing Best Practices](https://docs.docker.com/develop/dev-best-practices/)

---

*Este guia est√° em constante evolu√ß√£o. Contribui√ß√µes s√£o bem-vindas!* ü§ù
